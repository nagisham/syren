"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("@nagisham/standard"),d="listening:";function O(c){const n={},t=u=>n[u]??(n[u]={listeners:[]});function s(u,r){const a=t(u);a.listeners.forEach(f=>{f(r,a.previous)}),a.previous=r}function i(u){const{type:r,select:a,each:f,once:h}=u,_=u.equal??(c==null?void 0:c.equal),b=t(r);function o(){const{listeners:l}=b,p=l.indexOf(g);if(p===-1){console.warn("event engine: registered listener not found");return}l.splice(p,1)}function g(l,p){try{if(a&&(l&&(l=a(l)),p&&(p=a(p))),p&&(_!=null&&_(l,p)))return;f?f(l):h?(h(l),o()):console.error("event engine: no listener was provided")}catch(y){console.error(y)}}return b.listeners.push(g),r.startsWith(d)||s(d+r,g),o}return{fire:s,listen:i}}function m(c){const n={current:c,previous:c};function t(i){return i?n.previous:n.current}function s(i){n.previous=n.current,n.current=i}return{get:t,set:s}}const S=e.struct(c=>{const{get:n,set:t}=m(c),{fire:s,listen:i}=O();i({type:"listening:change",each:r=>{e.is_not_null(n())&&r(n())}}),i({type:"cleanup",each:()=>t(void 0)});function u(r){if(e.is_null(r))return n();const a=n(),f=e.unpack(r,a);Object.is(a,f)||(t(f),s("change",f))}return Object.assign(u,{fire:s,listen:i})});function N(c){return({set:n,listen:t})=>{const s=localStorage.getItem(c);e.is_not_null(s)&&n(JSON.parse(s)),t({type:"change",each:i=>{localStorage.setItem(c,JSON.stringify(i))}})}}function w(c){return({set:n,listen:t})=>{const s=sessionStorage.getItem(c);e.is_not_null(s)&&n(JSON.parse(s)),t({type:"change",each:i=>{sessionStorage.setItem(c,JSON.stringify(i))}})}}const j=e.struct((c,n)=>{const t=m(c),s=O();s.listen({type:"listening:change",each:r=>{e.is_not_null(t.get())&&r(t.get())}}),s.listen({type:"cleanup",each:()=>t.set(void 0)});function i(){return Object.assign({},t.get())}function u(r,a){var f;if(e.is_null(r)&&e.is_null(a))return i();if(e.is_object(r)||e.is_function(r)){const h=t.get(),_=Object.assign({},h,e.unpack(r,h));t.set(_),s.fire("change",_)}if(e.is_string(r)&&e.is_null(a))return(f=t.get())==null?void 0:f[r];if(e.is_string(r)&&e.is_not_null(a)){const h=t.get(),_=Object.assign({},h,{[r]:e.unpack(a,h==null?void 0:h[r])});t.set(_),s.fire("change",_)}}return n==null||n.forEach(r=>{r({...t,...s})}),Object.assign(u,s)}),I=e.struct(c=>{const{get:n,set:t}=m(c??[]),{fire:s,listen:i}=O();i({type:"listening:change",each:o=>{n().length&&o(u())}}),i({type:"cleanup",each:()=>t([])});function u(o){return n(o).slice()}function r(o,g){if(e.is_null(o)&&e.is_null(g))return u();if(e.is_array(o)||e.is_function(o)){const l=e.unpack(o,u());t(l),s("change",l);return}if(e.is_not_null(o)){const l=e.is_string(o)?parseInt(o):o;if(e.is_null(g))return n()[l];const p=n()[l];f(l,e.unpack(g,p))}}function a(o){return n().findIndex(o)}function f(o,g){const l=u();let p,y;e.is_null(g)?(p=l.length,y=o):(p=o,y=g),l.splice(p,0,y),t(l),s("insert",{index:p,element:y})}function h(o){const g=u(),l=g.splice(o,1)[0];return t(g),s("remove",{index:o,element:l}),l}function _(o){const g=n();if(e.is_null(o))return g.length;if(o===0){s("cleanup");return}let l=g.length;for(;l>o;)l--,h(l)}function b(o){n().forEach(o)}return Object.assign(r,{find:a,insert:f,remove:h,len:_,each:b,fire:s,listen:i})}),E=c=>{const{listener:n,dependency:t}=c,s=new Array;let i;const u={type:"change",each:()=>{}};return t.forEach(r=>{u.each=()=>{e.is_function(i)&&(i(),i=void 0);const a=t.map(e.Functions.call);a.every(e.is_not_null)&&(i=n(...a))},s.push(r.listen(u))}),()=>s.forEach(e.Functions.call)},J=c=>{const{listener:n,dependency:t}=c,s=S();return E({listener:(...i)=>{s(n(...i))},dependency:t}),s};function F(c,n){const t={},s=new Proxy(c(),{get:(u,r)=>(t.key=r,Reflect.get(u,r))}),i=S(n(s));return i.listen({type:"cleanup",once:e.combine(c.listen({type:"change",select:n,each:u=>{i(u)}}),i.listen({type:"change",each:u=>{c(t.key,u)}}))}),i}function P(c){return c instanceof S}function q(c){return c instanceof j}function R(c){return c instanceof I}exports.computed=J;exports.effect=E;exports.event_engine=O;exports.is_signal=P;exports.is_slice=q;exports.is_storage=R;exports.local_storage_middleware=N;exports.selector=F;exports.session_storage_middleware=w;exports.signal=S;exports.slice=j;exports.state_engine=m;exports.storage=I;
//# sourceMappingURL=main.cjs.map
